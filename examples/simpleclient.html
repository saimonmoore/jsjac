
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>JSJaC Simple Client</title>
    <script language="JavaScript" type="text/javascript" src="../sha1.js"></script>
    <script language="JavaScript" type="text/javascript" src="../xmlextras.js"></script>
    <script language="JavaScript" type="text/javascript" src="../JSJaCConnection.js"></script>
    <script language="JavaScript" type="text/javascript" src="../JSJaCPacket.js"></script>
    <script language="JavaScript" type="text/javascript" src="../JSJaCHttpPollingConnection.js"></script>
    <script language="JavaScript" type="text/javascript" src="../JSJaCHttpBindingConnection.js"></script>

 <!--  
	if you want to enable debugging uncomment line below
	debugger available at http://zeank.in-berlin.de/  
	 -->
  <!--  <script language="JavaScript" type="text/javascript" src="Debugger.js"></script> -->


    <script language="JavaScript" type="text/javascript">
      <!--
function htmlEnc(str) {
  if (!str)
    return null;

  str = str.replace(/&/g,"&amp;");
  str = str.replace(/</g,"&lt;");
  str = str.replace(/>/g,"&gt;");
  str = str.replace(/\"/g,"&quot;");
	str = str.replace(/\n/g,"<br />");
  return str;
}

function handleEvent(aJSJaCPacket) {
	document.getElementById('iResp').innerHTML += "IN (raw):<br/>" +htmlEnc(aJSJaCPacket.xml()) + '<hr noshade size="1"/>';
}

function handleMessage(aJSJaCPacket) {
	var html = '';
	html += '<b>Received Message from '+aJSJaCPacket.getFrom()+':</b><br/>';
	html += htmlEnc(aJSJaCPacket.getBody()) + '<hr noshade size="1"/>';
	document.getElementById('iResp').innerHTML += html;
}

function handlePresence(aJSJaCPacket) {
	var html = '';
	if (!aJSJaCPacket.getType() && !aJSJaCPacket.getShow()) 
		html += '<b>'+aJSJaCPacket.getFrom()+' has become available.</b>';
	else {
		html += '<b>'+aJSJaCPacket.getFrom()+' has set his presence to ';
		if (aJSJaCPacket.getType())
			html += aJSJaCPacket.getType() + '.</b>';
		else
			html += aJSJaCPacket.getShow() + '.</b>';
		if (aJSJaCPacket.getStatus())
			html += ' ('+htmlEnc(aJSJaCPacket.getStatus())+')';
	}
	html += '<hr noshade size=1>';

	document.getElementById('iResp').innerHTML += html;
}

function handleConnected() {
	document.getElementById('login_pane').style.display = 'none';
	document.getElementById('sendmsg_pane').style.display = '';
		
	con.send(new JSJaCPresence());
}


function handleError(e) {
	document.getElementById('login_err').innerHTML = "Couldn't connect. Please try again...<br />"+ 
		htmlEnc("Code: "+e.getAttribute('code')+"\nType: "+e.getAttribute('type')+"\nCondition: "+e.firstChild.nodeName); 
}

function doLogin(aForm) {

	try {

		// setup args for contructor
		oArgs = new Object();
		oArgs.httpbase = aForm.http_base.value;
		oArgs.timerval = 2000;

		if (typeof(oDbg) != 'undefined')
			oArgs.oDbg = oDbg;

		if (aForm.backend[0].checked)
			con = new JSJaCHttpBindingConnection(oArgs);
		else
			con = new JSJaCHttpPollingConnection(oArgs);

		con.registerHandler('message',handleMessage);
		con.registerHandler('presence',handlePresence);
		con.registerHandler('iq',handleEvent);
		con.registerHandler('onconnect',handleConnected);
		con.registerHandler('onerror',handleError);

		// setup args for connect method
		oArgs = new Object();
		oArgs.domain = aForm.server.value;
		oArgs.username = aForm.username.value;
		oArgs.resource = 'jsjac_simpleclient';
		oArgs.pass = aForm.password.value;
		con.connect(oArgs);
	} catch (e) {
		document.getElementById('login_err').innerHTML = e.toString();
	} finally {
		return false;
	}
}

function sendMsg(aForm) {
	var aMsg = new JSJaCMessage();
	aMsg.setTo(aForm.sendTo.value);
	aMsg.setBody(aForm.msg.value);
	con.send(aMsg);

	aForm.msg.value = '';

	return false;
}

function init() {
	if (typeof(Debugger) == 'function') {
		oDbg = new Debugger(4,'simpleclient');
		oDbg.start();
	}
}
onload = init;

onunload = function() { if (typeof(con) != 'undefined' && con.disconnect) con.disconnect(); };

			//-->
		</script>
		<style type="text/css">
/*<![CDATA[*/
			body {
			font-family: "Bitstream Vera Sans", sans;
			font-size: 0.8em;
			margin: 12px;
			}

			h2 {
			border-bottom: 1px solid grey;
			}

			input {
			border: 1px solid grey;
			}
			#iResp {
			width: 420px;
			height: 260px;

			overflow: auto;

			border: 2px dashed grey;
			
			padding: 4px;
			}

			#msgArea {
			width: 420px;
			height: 45px;

			padding: 4px;
			margin: 0;

			border: 2px dashed grey;
			}

			.spaced {
			margin-bottom: 4px;
			}
/*]]>*/
		</style>
  </head>

  <body>
    <h1>JSJaC Simple Client</h1>

		<div id="login_pane">
			<h2>Login</h2>
			<div id="login_err"></div>
			<form name="loginForm" onSubmit="return doLogin(this);">
				<table>
						<tr><th>Backend Type</th><td><input type="radio" name="backend" value="binding" id="backend1" tabindex="1"/> <label for="backend1">HTTP Binding</label><br /> <input type="radio" name="backend" value="polling" id="backend2" tabindex="2"/> <label for="backend2">HTTP Polling</label></td></tr>
						<tr><th><label for="http_base">HTTP Base</label></th><td><input type="text" name="http_base" id="http_base" tabindex="3"></td></tr>
						<tr><th><label for="server">Jabber Server</label></th><td><input type="text" name="server" id="server" tabindex="4"></td></tr>
						<tr><th><label for="username">Username</label></th><td><input type="text" name="username" id="username" tabindex="5"></td></tr>
						<tr><th><label for="password">Password</label></th><td><input type="password" name="password" id="password" tabindex="6"></td></tr>
						<tr><td>&nbsp;</td><td><input type="submit" value="Login" tabindex="7"></td></tr>
				</table>
			</form>
		</div>

		<div id="sendmsg_pane" style="display:none;">
			<h2>Incoming:</h2>
			<div name="iResp" id="iResp"></div>
			<h2>Send Message</h2>
			<form name="sendForm" onSubmit="return sendMsg(this);">
				<div class="spaced"><b>To:</b> <input type="text" name="sendTo"></div>
				<div class="spaced"><textarea name="msg" id='msgArea' rows=3 cols=80></textarea></div>
				<div class="spaced"><input type="submit" value="Send"></div>
		</div>

    <hr>
    <address><a href="mailto:steve@zeank.in-berlin.de">Stefan Strigler</a></address>
<!-- Created: Fri Oct  8 16:25:29 CEST 2004 -->
<!-- hhmts start -->
Last modified: Wed Feb 22 19:27:50 CET 2006
<!-- hhmts end -->
  </body>
</html>
